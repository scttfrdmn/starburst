<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>staRburst Architecture • starburst</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="staRburst Architecture"><meta property="og:image" content="https://starburst.ing/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">starburst</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data Processing Examples</h6></li>
    <li><a class="dropdown-item" href="articles/example-monte-carlo.html">Monte Carlo Simulation</a></li>
    <li><a class="dropdown-item" href="articles/example-api-calls.html">Bulk API Calls</a></li>
    <li><a class="dropdown-item" href="articles/example-geospatial.html">Geospatial Analysis</a></li>
    <li><a class="dropdown-item" href="articles/example-grid-search.html">Model Grid Search</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Business Use Cases</h6></li>
    <li><a class="dropdown-item" href="articles/example-risk-modeling.html">Financial Risk Modeling</a></li>
    <li><a class="dropdown-item" href="articles/example-feature-engineering.html">ML Feature Engineering</a></li>
    <li><a class="dropdown-item" href="articles/example-bootstrap.html">A/B Test Analysis</a></li>
    <li><a class="dropdown-item" href="articles/example-reports.html">Report Generation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="reference/examples.html">Runnable Scripts</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/scttfrdmn/starburst/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>staRburst Architecture</h1>
      <small class="dont-index">Source: <a href="https://github.com/scttfrdmn/starburst/blob/main/ARCHITECTURE.md" class="external-link"><code>ARCHITECTURE.md</code></a></small>
    </div>

<div id="starburst-architecture" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>staRburst is a future backend that enables seamless execution of parallel R workloads on AWS Fargate. It handles environment synchronization, data transfer, quota management, and worker orchestration automatically.</p>
</div>
<div class="section level2">
<h2 id="design-principles">Design Principles<a class="anchor" aria-label="anchor" href="#design-principles"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Simplicity First</strong>: Fargate over EC2, reasonable defaults over configuration</li>
<li>
<strong>Leverage Existing Standards</strong>: Built on future framework, uses standard R tools (renv)</li>
<li>
<strong>Fail Gracefully</strong>: Wave-based execution when quota-limited, clear error messages</li>
<li>
<strong>Cost Transparent</strong>: Always show estimated and actual costs</li>
<li>
<strong>Zero Babysitting</strong>: Auto-cleanup, auto-shutdown, automatic retries</li>
</ol></div>
<div class="section level2">
<h2 id="system-architecture">System Architecture<a class="anchor" aria-label="anchor" href="#system-architecture"></a></h2>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                      Local RStudio                           │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  User Code                                              │ │
│  │  plan(future_starburst, workers = 100)                 │ │
│  │  results &lt;- future_map(data, expensive_fn)             │ │
│  └─────────────────┬──────────────────────────────────────┘ │
│                    │                                          │
│  ┌─────────────────▼──────────────────────────────────────┐ │
│  │  staRburst Client Library                              │ │
│  │  • Environment snapshot (renv)                         │ │
│  │  • Quota checking                                       │ │
│  │  • Task serialization                                   │ │
│  │  • Result collection                                    │ │
│  └─────────────────┬──────────────────────────────────────┘ │
└────────────────────┼──────────────────────────────────────────┘
                     │
          ┌──────────▼────────────┐
          │    AWS Services       │
          └──────────┬────────────┘
                     │
     ┌───────────────┼───────────────┐
     │               │               │
┌────▼─────┐  ┌─────▼──────┐  ┌────▼─────┐
│    S3    │  │    ECR     │  │   ECS    │
│  Bucket  │  │ Repository │  │ Fargate  │
│          │  │            │  │          │
│ • Input  │  │ • Docker   │  │ • Tasks  │
│ • Output │  │   Images   │  │ • Logs   │
│ • Deps   │  │ • Caching  │  │          │
└──────────┘  └────────────┘  └────┬─────┘
                                    │
                     ┌──────────────┴──────────────┐
                     │                             │
              ┌──────▼───────┐            ┌───────▼──────┐
              │ Fargate Task │  ...       │ Fargate Task │
              │  Worker 1    │            │  Worker N    │
              │              │            │              │
              │ • Pull image │            │ • Pull image │
              │ • Get data   │            │ • Get data   │
              │ • Execute    │            │ • Execute    │
              │ • Push result│            │ • Push result│
              └──────────────┘            └──────────────┘</code></pre>
</div>
<div class="section level2">
<h2 id="component-deep-dive">Component Deep Dive<a class="anchor" aria-label="anchor" href="#component-deep-dive"></a></h2>
<div class="section level3">
<h3 id="id_1-client-library-local">1. Client Library (Local)<a class="anchor" aria-label="anchor" href="#id_1-client-library-local"></a></h3>
<p><strong>Responsibilities</strong>: - Environment management (renv snapshots) - Quota checking and wave orchestration - Task serialization and submission - Result collection and deserialization - Cost tracking and reporting</p>
<p><strong>Key Modules</strong>:</p>
<pre><code>R/
├── plan-starburst.R      # future backend implementation
├── setup.R               # One-time AWS configuration
├── quota.R               # Quota checking and management
├── environment.R         # renv snapshot and Docker image building
├── worker.R              # Fargate task management
├── serialize.R           # Task and result serialization
├── cost.R                # Cost estimation and tracking
└── utils.R               # Helpers and utilities</code></pre>
</div>
<div class="section level3">
<h3 id="id_2-environment-synchronization">2. Environment Synchronization<a class="anchor" aria-label="anchor" href="#id_2-environment-synchronization"></a></h3>
<p><strong>Challenge</strong>: Ensure worker R environments match local</p>
<p><strong>Solution</strong>: renv + Docker + Caching</p>
<pre><code>1. Local renv snapshot
   └─&gt; renv.lock file (exact package versions)

2. Docker image build
   ├─&gt; Base: rocker/r-ver:4.3.0
   ├─&gt; Install system deps
   ├─&gt; renv::restore(renv.lock)
   └─&gt; Add worker script

3. ECR caching
   ├─&gt; Tag: starburst-{hash(renv.lock)}
   ├─&gt; If exists: pull
   └─&gt; If new: build and push</code></pre>
<p><strong>Performance</strong>: - First run: 5-10 min (build Docker image) - Subsequent runs: &lt;10 sec (cached image) - Only rebuilds when packages change</p>
</div>
<div class="section level3">
<h3 id="id_3-task-execution-flow">3. Task Execution Flow<a class="anchor" aria-label="anchor" href="#id_3-task-execution-flow"></a></h3>
<p><strong>Submission</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># User code</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">future</span>({ <span class="fu">expensive_computation</span>(x) })</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Behind the scenes:</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="fl">1.</span> Capture expression and dependencies</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>   expr <span class="ot">&lt;-</span> <span class="fu">quote</span>({ <span class="fu">expensive_computation</span>(x) })</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>   deps <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> x, <span class="at">expensive_computation =</span> expensive_computation)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="fl">2.</span> Serialize to S3</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>   task_id <span class="ot">&lt;-</span> uuid<span class="sc">::</span><span class="fu">UUIDgenerate</span>()</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>   qs<span class="sc">::</span><span class="fu">qsave</span>(<span class="fu">list</span>(<span class="at">expr =</span> expr, <span class="at">deps =</span> deps), </span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>             <span class="fu">sprintf</span>(<span class="st">"s3://bucket/tasks/%s.qs"</span>, task_id))</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="fl">3.</span> Submit Fargate task</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>   <span class="fu">ecs_run_task</span>(</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>     <span class="at">taskDefinition =</span> <span class="st">"starburst-worker"</span>,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>     <span class="at">environment =</span> <span class="fu">list</span>(</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>       <span class="at">TASK_ID =</span> task_id,</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>       <span class="at">S3_BUCKET =</span> bucket</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>     )</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>   )</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="fl">4.</span> Return future object</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>   future_obj <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>     <span class="at">task_id =</span> task_id,</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>     <span class="at">submitted_at =</span> <span class="fu">Sys.time</span>(),</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>     <span class="at">state =</span> <span class="st">"running"</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>   )</span></code></pre></div>
<p><strong>Worker Execution</strong>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Worker container entrypoint</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get task info from environment</span></span>
<span>  <span class="va">task_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TASK_ID"</span><span class="op">)</span></span>
<span>  <span class="va">bucket</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"S3_BUCKET"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Download task</span></span>
<span>  <span class="va">task</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu">qread</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"s3://%s/tasks/%s.qs"</span>, <span class="va">bucket</span>, <span class="va">task_id</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Restore environment</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">deps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">task</span><span class="op">$</span><span class="va">deps</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Execute</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">expr</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>error <span class="op">=</span> <span class="cn">TRUE</span>, message <span class="op">=</span> <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Upload result</span></span>
<span>  <span class="fu">qs</span><span class="fu">::</span><span class="fu">qsave</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"s3://%s/results/%s.qs"</span>, <span class="va">bucket</span>, <span class="va">task_id</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Exit</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/quit.html" class="external-link">quit</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">main</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Result Collection</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># value(future) implementation</span></span>
<span><span class="va">value.starburst</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">future</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Poll for result</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="reference/result_exists.html">result_exists</a></span><span class="op">(</span><span class="va">future</span><span class="op">$</span><span class="va">task_id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Download result</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu">qread</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"s3://%s/results/%s.qs"</span>, <span class="va">bucket</span>, <span class="va">future</span><span class="op">$</span><span class="va">task_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Handle errors</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">error</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Cleanup</span></span>
<span>  <span class="fu">delete_task_files</span><span class="op">(</span><span class="va">future</span><span class="op">$</span><span class="va">task_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_4-quota-management">4. Quota Management<a class="anchor" aria-label="anchor" href="#id_4-quota-management"></a></h3>
<p><strong>Proactive Checking</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plan.starburst</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">workers</span>, <span class="va">cpu</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check quota before doing anything</span></span>
<span>  <span class="va">quota</span> <span class="op">&lt;-</span> <span class="fu">get_fargate_quota</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">needed</span> <span class="op">&lt;-</span> <span class="va">workers</span> <span class="op">*</span> <span class="va">cpu</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">needed</span> <span class="op">&gt;</span> <span class="va">quota</span><span class="op">$</span><span class="va">limit</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Calculate wave execution</span></span>
<span>    <span class="va">workers_per_wave</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">quota</span><span class="op">$</span><span class="va">limit</span> <span class="op">/</span> <span class="va">cpu</span><span class="op">)</span></span>
<span>    <span class="va">num_waves</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">workers</span> <span class="op">/</span> <span class="va">workers_per_wave</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Inform user</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>      <span class="st">"Quota allows %d workers, running in %d waves"</span>,</span>
<span>      <span class="va">workers_per_wave</span>, <span class="va">num_waves</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Offer quota increase</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">quota</span><span class="op">$</span><span class="va">increase_pending</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu">ask_user</span><span class="op">(</span><span class="st">"Request quota increase?"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="reference/request_quota_increase.html">request_quota_increase</a></span><span class="op">(</span><span class="fu"><a href="reference/suggest_quota.html">suggest_quota</a></span><span class="op">(</span><span class="va">needed</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Create wave-based plan</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">create_wave_plan</span><span class="op">(</span><span class="va">workers</span>, <span class="va">workers_per_wave</span>, <span class="va">num_waves</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Sufficient quota - normal plan</span></span>
<span>  <span class="fu">create_plan</span><span class="op">(</span><span class="va">workers</span>, <span class="va">cpu</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Wave Execution</strong>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">execute_with_waves</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tasks</span>, <span class="va">plan</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tasks</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">completed</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">wave</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">plan</span><span class="op">$</span><span class="va">num_waves</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Get tasks for this wave</span></span>
<span>    <span class="va">start_idx</span> <span class="op">&lt;-</span> <span class="va">completed</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">end_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">completed</span> <span class="op">+</span> <span class="va">plan</span><span class="op">$</span><span class="va">workers_per_wave</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tasks</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">wave_tasks</span> <span class="op">&lt;-</span> <span class="va">tasks</span><span class="op">[</span><span class="va">start_idx</span><span class="op">:</span><span class="va">end_idx</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Wave %d/%d: %d tasks"</span>, </span>
<span>                   <span class="va">wave</span>, <span class="va">plan</span><span class="op">$</span><span class="va">num_waves</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wave_tasks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Submit wave</span></span>
<span>    <span class="va">futures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">wave_tasks</span>, <span class="va">submit_task</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Collect results</span></span>
<span>    <span class="va">wave_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">futures</span>, <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="va">start_idx</span><span class="op">:</span><span class="va">end_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">wave_results</span></span>
<span>    </span>
<span>    <span class="va">completed</span> <span class="op">&lt;-</span> <span class="va">end_idx</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">results</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_5-cost-tracking">5. Cost Tracking<a class="anchor" aria-label="anchor" href="#id_5-cost-tracking"></a></h3>
<p><strong>Estimation</strong>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimate_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">workers</span>, <span class="va">cpu</span>, <span class="va">memory</span>, <span class="va">estimated_runtime_sec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Fargate pricing (us-east-1, as of 2025)</span></span>
<span>  <span class="va">vcpu_price_per_hour</span> <span class="op">&lt;-</span> <span class="fl">0.04048</span></span>
<span>  <span class="va">gb_price_per_hour</span> <span class="op">&lt;-</span> <span class="fl">0.004445</span></span>
<span>  </span>
<span>  <span class="va">memory_gb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parse_memory.html">parse_memory</a></span><span class="op">(</span><span class="va">memory</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">cost_per_hour</span> <span class="op">&lt;-</span> </span>
<span>    <span class="op">(</span><span class="va">cpu</span> <span class="op">*</span> <span class="va">vcpu_price_per_hour</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="op">(</span><span class="va">memory_gb</span> <span class="op">*</span> <span class="va">gb_price_per_hour</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">total_cost</span> <span class="op">&lt;-</span> <span class="va">cost_per_hour</span> <span class="op">*</span> <span class="va">workers</span> <span class="op">*</span> <span class="op">(</span><span class="va">estimated_runtime_sec</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    per_hour <span class="op">=</span> <span class="va">cost_per_hour</span>,</span>
<span>    total <span class="op">=</span> <span class="va">total_cost</span>,</span>
<span>    workers <span class="op">=</span> <span class="va">workers</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Actual Tracking</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cluster_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Query CloudWatch for actual runtime</span></span>
<span>  <span class="va">tasks</span> <span class="op">&lt;-</span> <span class="fu">list_tasks</span><span class="op">(</span><span class="va">cluster_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">total_cost</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">task</span> <span class="kw">in</span> <span class="va">tasks</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">runtime_sec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">stopped_at</span>, <span class="va">task</span><span class="op">$</span><span class="va">started_at</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span></span>
<span>    <span class="va">task_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculate_task_cost.html">calculate_task_cost</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">cpu</span>, <span class="va">task</span><span class="op">$</span><span class="va">memory</span>, <span class="va">runtime_sec</span><span class="op">)</span></span>
<span>    <span class="va">total_cost</span> <span class="op">&lt;-</span> <span class="va">total_cost</span> <span class="op">+</span> <span class="va">task_cost</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">total_cost</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_6-error-handling-and-retries">6. Error Handling and Retries<a class="anchor" aria-label="anchor" href="#id_6-error-handling-and-retries"></a></h3>
<p><strong>Worker Failures</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">submit_task_with_retry</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">task</span>, <span class="va">max_retries</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">attempt</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">max_retries</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">future</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/submit_task.html">submit_task</a></span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">future</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">attempt</span> <span class="op">==</span> <span class="va">max_retries</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Retry %d/%d: %s"</span>, <span class="va">attempt</span>, <span class="va">max_retries</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="va">attempt</span><span class="op">)</span>  <span class="co"># Exponential backoff</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Partial Results</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save results as they complete</span></span>
<span><span class="va">collect_results_progressive</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">futures</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">futures</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">futures</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">value</span><span class="op">(</span><span class="va">futures</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="co"># Save checkpoint</span></span>
<span>      <span class="fu">save_checkpoint</span><span class="op">(</span><span class="va">results</span>, <span class="va">i</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Task %d failed: %s"</span>, <span class="va">i</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">results</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-flow-optimization">Data Flow Optimization<a class="anchor" aria-label="anchor" href="#data-flow-optimization"></a></h2>
<div class="section level3">
<h3 id="serialization-strategy">Serialization Strategy<a class="anchor" aria-label="anchor" href="#serialization-strategy"></a></h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Choose serialization based on object type</span></span>
<span><span class="va">serialize_smart</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Large data frames: Arrow</span></span>
<span>    <span class="fu">arrow</span><span class="fu">::</span><span class="fu">write_parquet</span><span class="op">(</span><span class="va">obj</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu">is_large_object</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Large R objects: qs (fast compression)</span></span>
<span>    <span class="fu">qs</span><span class="fu">::</span><span class="fu">qsave</span><span class="op">(</span><span class="va">obj</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>, preset <span class="op">=</span> <span class="st">"fast"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Small objects: base serialize</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">obj</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="s3-upload-optimization">S3 Upload Optimization<a class="anchor" aria-label="anchor" href="#s3-upload-optimization"></a></h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parallel multipart upload for large objects</span></span>
<span><span class="va">upload_to_s3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span>, <span class="va">bucket</span>, <span class="va">key</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">file_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">file_size</span> <span class="op">&gt;</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># &gt;100MB</span></span>
<span>    <span class="co"># Use multipart upload</span></span>
<span>    <span class="fu">multipart_upload_parallel</span><span class="op">(</span><span class="va">file</span>, <span class="va">bucket</span>, <span class="va">key</span>, </span>
<span>                              part_size <span class="op">=</span> <span class="fl">50</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>                              num_threads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Simple upload</span></span>
<span>    <span class="fu">put_object</span><span class="op">(</span><span class="va">file</span>, <span class="va">bucket</span>, <span class="va">key</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="security">Security<a class="anchor" aria-label="anchor" href="#security"></a></h2>
<p><strong>IAM Roles</strong>: - User: <code>starburst-user</code> with permissions for ECS, S3, ECR, Service Quotas - Task: <code>starburst-worker-execution</code> for pulling images - Worker: <code>starburst-worker-task</code> for S3 access only</p>
<p><strong>S3 Bucket</strong>: - Private by default - Encryption at rest (SSE-S3) - Lifecycle policy: delete after 7 days - Access logging enabled</p>
<p><strong>Network</strong>: - Workers in private subnets (NAT gateway for S3/ECR access) - Security groups: egress only to AWS services - No SSH access to containers</p>
</div>
<div class="section level2">
<h2 id="monitoring-and-debugging">Monitoring and Debugging<a class="anchor" aria-label="anchor" href="#monitoring-and-debugging"></a></h2>
<p><strong>CloudWatch Logs</strong>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View worker logs</span></span>
<span><span class="fu"><a href="reference/starburst_logs.html">starburst_logs</a></span><span class="op">(</span>task_id <span class="op">=</span> <span class="st">"12345"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/starburst_logs.html">starburst_logs</a></span><span class="op">(</span>cluster_id <span class="op">=</span> <span class="st">"cluster-67890"</span>, last_n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><strong>Task Status</strong>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check running tasks</span></span>
<span><span class="fu"><a href="reference/starburst_status.html">starburst_status</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># &gt; 3 workers running</span></span>
<span><span class="co"># &gt; 47 tasks completed</span></span>
<span><span class="co"># &gt; 0 tasks failed</span></span>
<span><span class="co"># &gt; Est. cost so far: $2.34</span></span></code></pre></div>
<p><strong>Debug Mode</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Keep workers alive for debugging</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">future_starburst</span>, workers <span class="op">=</span> <span class="fl">1</span>, debug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Workers stay alive, can SSH via AWS Session Manager</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performance-benchmarks">Performance Benchmarks<a class="anchor" aria-label="anchor" href="#performance-benchmarks"></a></h2>
<p><strong>Overhead Analysis</strong> (100 workers, 4 vCPU each):</p>
<table class="table"><thead><tr class="header"><th>Component</th>
<th>Time</th>
<th>Percentage</th>
</tr></thead><tbody><tr class="odd"><td>Quota check</td>
<td>0.5s</td>
<td>0.8%</td>
</tr><tr class="even"><td>Environment sync (cached)</td>
<td>2s</td>
<td>3.2%</td>
</tr><tr class="odd"><td>Task serialization</td>
<td>3s</td>
<td>4.8%</td>
</tr><tr class="even"><td>Fargate cold start</td>
<td>45s</td>
<td>72%</td>
</tr><tr class="odd"><td>Result collection</td>
<td>5s</td>
<td>8%</td>
</tr><tr class="even"><td>Cleanup</td>
<td>1s</td>
<td>1.6%</td>
</tr><tr class="odd"><td><strong>Total overhead</strong></td>
<td><strong>56.5s</strong></td>
<td><strong>100%</strong></td>
</tr></tbody></table><p><strong>Crossover Point</strong>: - Local task time: 1 min → Not worth cloud (overhead = 56s) - Local task time: 5 min → Marginal (overhead = 19%) - Local task time: 30 min → Clear win (overhead = 3%)</p>
<p><strong>Scalability</strong>: - 10 workers: Linear overhead - 100 workers: Linear overhead (wave-based if quota-limited) - 1000 workers: Requires quota increase, linear overhead with waves</p>
</div>
<div class="section level2">
<h2 id="future-extensions">Future Extensions<a class="anchor" aria-label="anchor" href="#future-extensions"></a></h2>
<div class="section level3">
<h3 id="gpu-support-v11">GPU Support (v1.1)<a class="anchor" aria-label="anchor" href="#gpu-support-v11"></a></h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plan</span><span class="op">(</span><span class="va">future_starburst</span>, </span>
<span>     workers <span class="op">=</span> <span class="fl">10</span>, </span>
<span>     gpu <span class="op">=</span> <span class="st">"nvidia-t4"</span>,  <span class="co"># Triggers EC2 instead of Fargate</span></span>
<span>     instance <span class="op">=</span> <span class="st">"g4dn.xlarge"</span><span class="op">)</span></span></code></pre></div>
<p>Implementation: Switch from Fargate to EC2 Batch, same task execution model.</p>
</div>
<div class="section level3">
<h3 id="spot-instances-v11">Spot Instances (v1.1)<a class="anchor" aria-label="anchor" href="#spot-instances-v11"></a></h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plan</span><span class="op">(</span><span class="va">future_starburst</span>,</span>
<span>     workers <span class="op">=</span> <span class="fl">100</span>,</span>
<span>     spot <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Use spot instances</span></span>
<span>     max_price <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>  <span class="co"># Bid price</span></span></code></pre></div>
<p>Implementation: EC2 Spot Fleet with interruption handling and checkpointing.</p>
</div>
<div class="section level3">
<h3 id="emr-integration-v12">EMR Integration (v1.2)<a class="anchor" aria-label="anchor" href="#emr-integration-v12"></a></h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plan</span><span class="op">(</span><span class="va">future_starburst_spark</span>,</span>
<span>     workers <span class="op">=</span> <span class="fl">20</span>,</span>
<span>     spark_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       executor_memory <span class="op">=</span> <span class="st">"8g"</span>,</span>
<span>       executor_cores <span class="op">=</span> <span class="fl">4</span></span>
<span>     <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Implementation: Separate backend using EMR + sparklyr, different data model (distributed DataFrames).</p>
</div>
</div>
<div class="section level2">
<h2 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h2>
<p><strong>Unit Tests</strong>: - Serialization/deserialization correctness - Quota calculation logic - Cost estimation accuracy</p>
<p><strong>Integration Tests</strong> (requires AWS): - Environment sync end-to-end - Task submission and result collection - Wave-based execution - Error handling and retries</p>
<p><strong>Load Tests</strong>: - 100 workers, 1000 tasks - Quota-limited scenarios - Large data transfer (1GB+ objects)</p>
<p><strong>Cost Tests</strong>: - Track actual vs estimated costs - Ensure no runaway billing - Cleanup verification</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
<ul><li><a href="https://aws.amazon.com/fargate/pricing/" class="external-link">AWS Fargate Pricing</a></li>
<li><a href="https://future.futureverse.org/" class="external-link">future Framework</a></li>
<li><a href="https://rstudio.github.io/renv/" class="external-link">renv Documentation</a></li>
<li><a href="https://docs.aws.amazon.com/servicequotas/" class="external-link">AWS Service Quotas</a></li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>staRburst is developed by <a href="https://github.com/scttfrdmn" class="external-link">Scott Friedman</a>.</p><p>Contact: <a href="mailto:help@starburst.ing">help@starburst.ing</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> and powered by <a href="https://paws-r.github.io/" class="external-link">paws</a>.</p>
</div>

    </footer></div>





  </body></html>

