<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example: Parallel Geospatial Analysis • starburst</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example: Parallel Geospatial Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">starburst</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data Processing Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example-monte-carlo.html">Monte Carlo Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/example-api-calls.html">Bulk API Calls</a></li>
    <li><a class="dropdown-item" href="../articles/example-geospatial.html">Geospatial Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/example-grid-search.html">Model Grid Search</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Business Use Cases</h6></li>
    <li><a class="dropdown-item" href="../articles/example-risk-modeling.html">Financial Risk Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/example-feature-engineering.html">ML Feature Engineering</a></li>
    <li><a class="dropdown-item" href="../articles/example-bootstrap.html">A/B Test Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/example-reports.html">Report Generation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/examples.html">Runnable Scripts</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/scttfrdmn/starburst/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example: Parallel Geospatial Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/scttfrdmn/starburst/blob/main/vignettes/example-geospatial.Rmd" class="external-link"><code>vignettes/example-geospatial.Rmd</code></a></small>
      <div class="d-none name"><code>example-geospatial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Geospatial analysis often involves computationally expensive
operations like distance calculations, spatial joins, and geometric
operations across large datasets. This example demonstrates
parallelizing spatial analysis across geographic regions.</p>
<p><strong>Use Case</strong>: Store location optimization, delivery
route planning, spatial market analysis, environmental modeling</p>
<p><strong>Computational Pattern</strong>: Spatial data parallelism with
region-based chunking</p>
</div>
<div class="section level2">
<h2 id="the-problem">The Problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h2>
<p>You need to analyze 100 retail locations across 20 metropolitan areas
to: - Calculate distances to competitors - Identify optimal delivery
zones - Compute demographic coverage - Analyze spatial clustering -
Generate market penetration metrics</p>
<p>Each region can be analyzed independently, making this ideal for
parallel processing.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://starburst.ing" class="external-link">starburst</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-sample-data">Generate Sample Data<a class="anchor" aria-label="anchor" href="#generate-sample-data"></a>
</h2>
<p>Create synthetic geospatial data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define 20 metropolitan regions (simplified coordinates)</span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  region_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,</span>
<span>  region_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"New York"</span>, <span class="st">"Los Angeles"</span>, <span class="st">"Chicago"</span>, <span class="st">"Houston"</span>, <span class="st">"Phoenix"</span>,</span>
<span>                 <span class="st">"Philadelphia"</span>, <span class="st">"San Antonio"</span>, <span class="st">"San Diego"</span>, <span class="st">"Dallas"</span>, <span class="st">"San Jose"</span>,</span>
<span>                 <span class="st">"Austin"</span>, <span class="st">"Jacksonville"</span>, <span class="st">"Fort Worth"</span>, <span class="st">"Columbus"</span>, <span class="st">"Charlotte"</span>,</span>
<span>                 <span class="st">"San Francisco"</span>, <span class="st">"Indianapolis"</span>, <span class="st">"Seattle"</span>, <span class="st">"Denver"</span>, <span class="st">"Boston"</span><span class="op">)</span>,</span>
<span>  center_lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.71</span>, <span class="fl">34.05</span>, <span class="fl">41.88</span>, <span class="fl">29.76</span>, <span class="fl">33.45</span>,</span>
<span>                <span class="fl">39.95</span>, <span class="fl">29.42</span>, <span class="fl">32.72</span>, <span class="fl">32.78</span>, <span class="fl">37.34</span>,</span>
<span>                <span class="fl">30.27</span>, <span class="fl">30.33</span>, <span class="fl">32.75</span>, <span class="fl">39.96</span>, <span class="fl">35.23</span>,</span>
<span>                <span class="fl">37.77</span>, <span class="fl">39.77</span>, <span class="fl">47.61</span>, <span class="fl">39.74</span>, <span class="fl">42.36</span><span class="op">)</span>,</span>
<span>  center_lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">74.01</span>, <span class="op">-</span><span class="fl">118.24</span>, <span class="op">-</span><span class="fl">87.63</span>, <span class="op">-</span><span class="fl">95.37</span>, <span class="op">-</span><span class="fl">112.07</span>,</span>
<span>                <span class="op">-</span><span class="fl">75.17</span>, <span class="op">-</span><span class="fl">98.49</span>, <span class="op">-</span><span class="fl">117.16</span>, <span class="op">-</span><span class="fl">96.80</span>, <span class="op">-</span><span class="fl">121.89</span>,</span>
<span>                <span class="op">-</span><span class="fl">97.74</span>, <span class="op">-</span><span class="fl">81.66</span>, <span class="op">-</span><span class="fl">97.33</span>, <span class="op">-</span><span class="fl">83.00</span>, <span class="op">-</span><span class="fl">80.84</span>,</span>
<span>                <span class="op">-</span><span class="fl">122.42</span>, <span class="op">-</span><span class="fl">86.16</span>, <span class="op">-</span><span class="fl">122.33</span>, <span class="op">-</span><span class="fl">104.99</span>, <span class="op">-</span><span class="fl">71.06</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate store locations (5 per region)</span></span>
<span><span class="va">stores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_stores</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span>  <span class="co"># Add random offset to region center</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    store_id <span class="op">=</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">n_stores</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_stores</span>,</span>
<span>    region_id <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">region_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    region_name <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">region_name</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    latitude <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">center_lat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_stores</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    longitude <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">center_lon</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_stores</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    annual_revenue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n_stores</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1000000</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate competitor locations (10 per region)</span></span>
<span><span class="va">competitors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_competitors</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    competitor_id <span class="op">=</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">n_competitors</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_competitors</span>,</span>
<span>    region_id <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">region_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    latitude <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">center_lat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_competitors</span>, <span class="fl">0</span>, <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>    longitude <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">center_lon</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_competitors</span>, <span class="fl">0</span>, <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate customer points (1000 per region)</span></span>
<span><span class="va">customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_customers</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    customer_id <span class="op">=</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">n_customers</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_customers</span>,</span>
<span>    region_id <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">region_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    latitude <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">center_lat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_customers</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    longitude <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">center_lon</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_customers</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    annual_spend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n_customers</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Dataset created:\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %d stores across %d regions\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">stores</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s competitors\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">competitors</span><span class="op">)</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s customers\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">customers</span><span class="op">)</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>Dataset created:
  100 stores across 20 regions
  200 competitors
  20,000 customers</code></pre>
</div>
<div class="section level2">
<h2 id="spatial-analysis-function">Spatial Analysis Function<a class="anchor" aria-label="anchor" href="#spatial-analysis-function"></a>
</h2>
<p>Define a function that performs spatial analysis for a region:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Haversine distance function (in km)</span></span>
<span><span class="va">haversine_distance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lat1</span>, <span class="va">lon1</span>, <span class="va">lat2</span>, <span class="va">lon2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">6371</span>  <span class="co"># Earth's radius in km</span></span>
<span></span>
<span>  <span class="va">lat1_rad</span> <span class="op">&lt;-</span> <span class="va">lat1</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span></span>
<span>  <span class="va">lat2_rad</span> <span class="op">&lt;-</span> <span class="va">lat2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span></span>
<span>  <span class="va">delta_lat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lat2</span> <span class="op">-</span> <span class="va">lat1</span><span class="op">)</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span></span>
<span>  <span class="va">delta_lon</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lon2</span> <span class="op">-</span> <span class="va">lon1</span><span class="op">)</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span></span>
<span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">delta_lat</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">lat1_rad</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">lat2_rad</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">delta_lon</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">R</span> <span class="op">*</span> <span class="va">c</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">analyze_region</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">region_id</span>, <span class="va">stores_data</span>, <span class="va">competitors_data</span>,</span>
<span>                          <span class="va">customers_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Filter data for this region</span></span>
<span>  <span class="va">region_stores</span> <span class="op">&lt;-</span> <span class="va">stores_data</span><span class="op">[</span><span class="va">stores_data</span><span class="op">$</span><span class="va">region_id</span> <span class="op">==</span> <span class="va">region_id</span>, <span class="op">]</span></span>
<span>  <span class="va">region_competitors</span> <span class="op">&lt;-</span> <span class="va">competitors_data</span><span class="op">[</span><span class="va">competitors_data</span><span class="op">$</span><span class="va">region_id</span> <span class="op">==</span> <span class="va">region_id</span>, <span class="op">]</span></span>
<span>  <span class="va">region_customers</span> <span class="op">&lt;-</span> <span class="va">customers_data</span><span class="op">[</span><span class="va">customers_data</span><span class="op">$</span><span class="va">region_id</span> <span class="op">==</span> <span class="va">region_id</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_stores</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Analyze each store</span></span>
<span>  <span class="va">store_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_stores</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">store</span> <span class="op">&lt;-</span> <span class="va">region_stores</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Distance to nearest competitor</span></span>
<span>    <span class="va">competitor_distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_competitors</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">haversine_distance</span><span class="op">(</span></span>
<span>        <span class="va">store</span><span class="op">$</span><span class="va">latitude</span>, <span class="va">store</span><span class="op">$</span><span class="va">longitude</span>,</span>
<span>        <span class="va">region_competitors</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">region_competitors</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">nearest_competitor_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">competitor_distances</span><span class="op">)</span></span>
<span>    <span class="va">avg_competitor_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">competitor_distances</span><span class="op">)</span></span>
<span>    <span class="va">competitors_within_5km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">competitor_distances</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Customer coverage analysis</span></span>
<span>    <span class="va">customer_distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_customers</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">haversine_distance</span><span class="op">(</span></span>
<span>        <span class="va">store</span><span class="op">$</span><span class="va">latitude</span>, <span class="va">store</span><span class="op">$</span><span class="va">longitude</span>,</span>
<span>        <span class="va">region_customers</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">region_customers</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Customers within radius</span></span>
<span>    <span class="va">customers_1km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">customer_distances</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">customers_3km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">customer_distances</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">customers_5km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">customer_distances</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="va">customers_10km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">customer_distances</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Market potential (customers within 5km)</span></span>
<span>    <span class="va">nearby_customers</span> <span class="op">&lt;-</span> <span class="va">region_customers</span><span class="op">[</span><span class="va">customer_distances</span> <span class="op">&lt;=</span> <span class="fl">5</span>, <span class="op">]</span></span>
<span>    <span class="va">market_potential</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nearby_customers</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nearby_customers</span><span class="op">$</span><span class="va">annual_spend</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fl">0</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Average distance to customers</span></span>
<span>    <span class="va">avg_customer_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">customer_distances</span><span class="op">)</span></span>
<span>    <span class="va">median_customer_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">customer_distances</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Spatial density (customers per km² within 10km radius)</span></span>
<span>    <span class="va">area_10km</span> <span class="op">&lt;-</span> <span class="va">pi</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="fl">2</span>  <span class="co"># ~314 km²</span></span>
<span>    <span class="va">customer_density</span> <span class="op">&lt;-</span> <span class="va">customers_10km</span> <span class="op">/</span> <span class="va">area_10km</span></span>
<span></span>
<span>    <span class="co"># Competitive intensity score (0-1, higher = more competitive)</span></span>
<span>    <span class="va">competitive_intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">competitors_within_5km</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      store_id <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">store_id</span>,</span>
<span>      region_id <span class="op">=</span> <span class="va">region_id</span>,</span>
<span>      region_name <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">region_name</span>,</span>
<span>      annual_revenue <span class="op">=</span> <span class="va">store</span><span class="op">$</span><span class="va">annual_revenue</span>,</span>
<span>      nearest_competitor_km <span class="op">=</span> <span class="va">nearest_competitor_km</span>,</span>
<span>      avg_competitor_distance <span class="op">=</span> <span class="va">avg_competitor_distance</span>,</span>
<span>      competitors_within_5km <span class="op">=</span> <span class="va">competitors_within_5km</span>,</span>
<span>      customers_1km <span class="op">=</span> <span class="va">customers_1km</span>,</span>
<span>      customers_3km <span class="op">=</span> <span class="va">customers_3km</span>,</span>
<span>      customers_5km <span class="op">=</span> <span class="va">customers_5km</span>,</span>
<span>      customers_10km <span class="op">=</span> <span class="va">customers_10km</span>,</span>
<span>      market_potential <span class="op">=</span> <span class="va">market_potential</span>,</span>
<span>      avg_customer_distance <span class="op">=</span> <span class="va">avg_customer_distance</span>,</span>
<span>      median_customer_distance <span class="op">=</span> <span class="va">median_customer_distance</span>,</span>
<span>      customer_density <span class="op">=</span> <span class="va">customer_density</span>,</span>
<span>      competitive_intensity <span class="op">=</span> <span class="va">competitive_intensity</span>,</span>
<span>      stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">store_metrics</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="local-execution">Local Execution<a class="anchor" aria-label="anchor" href="#local-execution"></a>
</h2>
<p>Test spatial analysis locally on a subset of regions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze 3 regions locally</span></span>
<span><span class="va">test_regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Analyzing %d regions locally...\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">test_regions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">local_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">local_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">test_regions</span>, <span class="va">analyze_region</span>,</span>
<span>                       stores_data <span class="op">=</span> <span class="va">stores</span>,</span>
<span>                       competitors_data <span class="op">=</span> <span class="va">competitors</span>,</span>
<span>                       customers_data <span class="op">=</span> <span class="va">customers</span><span class="op">)</span></span>
<span><span class="va">local_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">local_results</span><span class="op">)</span></span>
<span></span>
<span><span class="va">local_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">local_start</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"✓ Completed in %.2f seconds\n"</span>, <span class="va">local_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Processed %d stores\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">local_metrics</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Estimated time for all %d regions: %.1f seconds\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span>, <span class="va">local_time</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">test_regions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Typical output</strong>:</p>
<pre><code>Analyzing 3 regions locally...
✓ Completed in 4.5 seconds
  Processed 15 stores
  Estimated time for all 20 regions: 30.0 seconds</code></pre>
<p>For all 20 regions locally: <strong>~30 seconds</strong></p>
</div>
<div class="section level2">
<h2 id="cloud-execution-with-starburst">Cloud Execution with staRburst<a class="anchor" aria-label="anchor" href="#cloud-execution-with-starburst"></a>
</h2>
<p>Analyze all regions in parallel on AWS:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_workers</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Analyzing %d regions on %d workers...\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span>, <span class="va">n_workers</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cloud_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/starburst_map.html">starburst_map</a></span><span class="op">(</span></span>
<span>  <span class="va">regions</span><span class="op">$</span><span class="va">region_id</span>,</span>
<span>  <span class="va">analyze_region</span>,</span>
<span>  stores_data <span class="op">=</span> <span class="va">stores</span>,</span>
<span>  competitors_data <span class="op">=</span> <span class="va">competitors</span>,</span>
<span>  customers_data <span class="op">=</span> <span class="va">customers</span>,</span>
<span>  workers <span class="op">=</span> <span class="va">n_workers</span>,</span>
<span>  cpu <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  memory <span class="op">=</span> <span class="st">"4GB"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cloud_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">cloud_start</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\n✓ Completed in %.1f seconds\n"</span>, <span class="va">cloud_time</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine results</span></span>
<span><span class="va">spatial_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p><strong>Typical output</strong>:</p>
<pre><code>🚀 Starting starburst cluster with 20 workers
💰 Estimated cost: ~$1.60/hour
📊 Processing 20 items with 20 workers
📦 Created 20 chunks (avg 1 region per chunk)
🚀 Submitting tasks...
✓ Submitted 20 tasks
⏳ Progress: 20/20 tasks (4.8 seconds elapsed)

✓ Completed in 4.8 seconds
💰 Actual cost: $0.002</code></pre>
</div>
<div class="section level2">
<h2 id="results-analysis">Results Analysis<a class="anchor" aria-label="anchor" href="#results-analysis"></a>
</h2>
<p>Analyze the spatial metrics:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Geospatial Analysis Results ===\n\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Total stores analyzed: %d\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Regions covered: %d\n\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">region_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Competition metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Competition Analysis ===\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Average distance to nearest competitor: %.2f km\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">nearest_competitor_km</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Median distance to nearest competitor: %.2f km\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">nearest_competitor_km</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Average competitors within 5km: %.1f\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">competitors_within_5km</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Stores with high competition (5+ competitors within 5km): %d (%.1f%%)\n\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">competitors_within_5km</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">competitors_within_5km</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Customer coverage</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Customer Coverage Analysis ===\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Average customers within 5km: %.0f\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">customers_5km</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Average market potential (5km radius): $%.0f\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Average customer density: %.1f customers/km²\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">customer_density</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Median distance to customers: %.2f km\n\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">median_customer_distance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store performance correlation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Performance Insights ===\n"</span><span class="op">)</span></span>
<span><span class="va">correlation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">annual_revenue</span>,</span>
<span>                   <span class="va">spatial_metrics</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Correlation (revenue vs market potential): %.3f\n"</span>, <span class="va">correlation</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify opportunity stores</span></span>
<span><span class="va">opportunity_stores</span> <span class="op">&lt;-</span> <span class="va">spatial_metrics</span><span class="op">[</span></span>
<span>  <span class="va">spatial_metrics</span><span class="op">$</span><span class="va">market_potential</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="va">spatial_metrics</span><span class="op">$</span><span class="va">competitors_within_5km</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">competitors_within_5km</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nHigh opportunity stores (low competition, high potential): %d\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">opportunity_stores</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">opportunity_stores</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Average market potential: $%.0f\n"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">opportunity_stores</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Average competitors nearby: %.1f\n"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">opportunity_stores</span><span class="op">$</span><span class="va">competitors_within_5km</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Identify challenged stores</span></span>
<span><span class="va">challenged_stores</span> <span class="op">&lt;-</span> <span class="va">spatial_metrics</span><span class="op">[</span></span>
<span>  <span class="va">spatial_metrics</span><span class="op">$</span><span class="va">competitive_intensity</span> <span class="op">&gt;</span> <span class="fl">0.7</span> <span class="op">&amp;</span></span>
<span>  <span class="va">spatial_metrics</span><span class="op">$</span><span class="va">market_potential</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">spatial_metrics</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nChallenged stores (high competition, low potential): %d\n"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">challenged_stores</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">challenged_stores</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Average market potential: $%.0f\n"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">challenged_stores</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Average competitors nearby: %.1f\n"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">challenged_stores</span><span class="op">$</span><span class="va">competitors_within_5km</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Top regions by market potential</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Top 5 Regions by Market Potential ===\n"</span><span class="op">)</span></span>
<span><span class="va">region_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">market_potential</span> <span class="op">~</span> <span class="va">region_name</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">spatial_metrics</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">region_summary</span> <span class="op">&lt;-</span> <span class="va">region_summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">region_summary</span><span class="op">$</span><span class="va">market_potential</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_summary</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%d. %s: $%.0f\n"</span>, <span class="va">i</span>,</span>
<span>              <span class="va">region_summary</span><span class="op">$</span><span class="va">region_name</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>              <span class="va">region_summary</span><span class="op">$</span><span class="va">market_potential</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Typical output</strong>:</p>
<pre><code>=== Geospatial Analysis Results ===

Total stores analyzed: 100
Regions covered: 20

=== Competition Analysis ===
Average distance to nearest competitor: 2.34 km
Median distance to nearest competitor: 2.18 km
Average competitors within 5km: 6.2
Stores with high competition (5+ competitors within 5km): 58 (58.0%)

=== Customer Coverage Analysis ===
Average customers within 5km: 512
Average market potential (5km radius): $256,345
Average customer density: 3.2 customers/km²
Median distance to customers: 4.12 km

=== Performance Insights ===
Correlation (revenue vs market potential): 0.423

High opportunity stores (low competition, high potential): 12
  Average market potential: $342,567
  Average competitors nearby: 3.2

Challenged stores (high competition, low potential): 8
  Average market potential: $178,234
  Average competitors nearby: 8.4

=== Top 5 Regions by Market Potential ===
1. New York: $298,456
2. Los Angeles: $287,234
3. Chicago: $276,890
4. San Francisco: $265,123
5. Boston: $258,901</code></pre>
</div>
<div class="section level2">
<h2 id="performance-comparison">Performance Comparison<a class="anchor" aria-label="anchor" href="#performance-comparison"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Method</th>
<th>Regions</th>
<th>Time</th>
<th>Cost</th>
<th>Speedup</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Local</td>
<td>3</td>
<td>4.5 sec</td>
<td>$0</td>
<td>-</td>
</tr>
<tr class="even">
<td>Local (est.)</td>
<td>20</td>
<td>30 sec</td>
<td>$0</td>
<td>1x</td>
</tr>
<tr class="odd">
<td>staRburst</td>
<td>20</td>
<td>4.8 sec</td>
<td>$0.002</td>
<td>6.3x</td>
</tr>
</tbody>
</table>
<p><strong>Key Insights</strong>: - Excellent parallelization for
spatial operations - Near-linear scaling across regions - Minimal cost
even with complex calculations - Can easily scale to 100+ regions</p>
</div>
<div class="section level2">
<h2 id="advanced-delivery-zone-optimization">Advanced: Delivery Zone Optimization<a class="anchor" aria-label="anchor" href="#advanced-delivery-zone-optimization"></a>
</h2>
<p>Extend to compute optimal delivery zones:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimize_delivery_zones</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">region_id</span>, <span class="va">stores_data</span>, <span class="va">customers_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">region_stores</span> <span class="op">&lt;-</span> <span class="va">stores_data</span><span class="op">[</span><span class="va">stores_data</span><span class="op">$</span><span class="va">region_id</span> <span class="op">==</span> <span class="va">region_id</span>, <span class="op">]</span></span>
<span>  <span class="va">region_customers</span> <span class="op">&lt;-</span> <span class="va">customers_data</span><span class="op">[</span><span class="va">customers_data</span><span class="op">$</span><span class="va">region_id</span> <span class="op">==</span> <span class="va">region_id</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Assign each customer to nearest store</span></span>
<span>  <span class="va">customer_assignments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_customers</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">customer</span> <span class="op">&lt;-</span> <span class="va">region_customers</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span></span>
<span>    <span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">region_stores</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">haversine_distance</span><span class="op">(</span></span>
<span>        <span class="va">customer</span><span class="op">$</span><span class="va">latitude</span>, <span class="va">customer</span><span class="op">$</span><span class="va">longitude</span>,</span>
<span>        <span class="va">region_stores</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">region_stores</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">nearest_store</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      customer_id <span class="op">=</span> <span class="va">customer</span><span class="op">$</span><span class="va">customer_id</span>,</span>
<span>      assigned_store <span class="op">=</span> <span class="va">region_stores</span><span class="op">$</span><span class="va">store_id</span><span class="op">[</span><span class="va">nearest_store</span><span class="op">]</span>,</span>
<span>      distance_km <span class="op">=</span> <span class="va">distances</span><span class="op">[</span><span class="va">nearest_store</span><span class="op">]</span>,</span>
<span>      annual_spend <span class="op">=</span> <span class="va">customer</span><span class="op">$</span><span class="va">annual_spend</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Aggregate by store</span></span>
<span>  <span class="va">assignments_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">customer_assignments</span>, <span class="va">as.data.frame</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">store_zones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>customer_count <span class="op">=</span> <span class="va">customer_id</span>,</span>
<span>          total_revenue <span class="op">=</span> <span class="va">annual_spend</span>,</span>
<span>          avg_distance <span class="op">=</span> <span class="va">distance_km</span><span class="op">)</span> <span class="op">~</span> <span class="va">assigned_store</span>,</span>
<span>    data <span class="op">=</span> <span class="va">assignments_df</span>,</span>
<span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">store_zones</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run optimization</span></span>
<span><span class="va">zone_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/starburst_map.html">starburst_map</a></span><span class="op">(</span></span>
<span>  <span class="va">regions</span><span class="op">$</span><span class="va">region_id</span>,</span>
<span>  <span class="va">optimize_delivery_zones</span>,</span>
<span>  stores_data <span class="op">=</span> <span class="va">stores</span>,</span>
<span>  customers_data <span class="op">=</span> <span class="va">customers</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="when-to-use-this-pattern">When to Use This Pattern<a class="anchor" aria-label="anchor" href="#when-to-use-this-pattern"></a>
</h2>
<p><strong>Good fit</strong>: - Regional analysis with independent
processing - Distance/proximity calculations at scale - Spatial
clustering and segmentation - Territory optimization - Multi-location
planning</p>
<p><strong>Not ideal</strong>: - Global spatial operations (e.g.,
nearest neighbor across all points) - Very small datasets (&lt; 1,000
points) - Real-time single-point queries - Operations requiring spatial
indexes across all data</p>
</div>
<div class="section level2">
<h2 id="running-the-full-example">Running the Full Example<a class="anchor" aria-label="anchor" href="#running-the-full-example"></a>
</h2>
<p>The complete runnable script is available at:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/geospatial.R"</span>, package <span class="op">=</span> <span class="st">"starburst"</span><span class="op">)</span></span></code></pre></div>
<p>Run it with:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/geospatial.R"</span>, package <span class="op">=</span> <span class="st">"starburst"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>Scale to thousands of locations</li>
<li>Add route optimization algorithms</li>
<li>Integrate with real GIS data (shapefiles, rasters)</li>
<li>Implement spatial clustering algorithms</li>
<li>Add time-based analysis (traffic patterns)</li>
</ul>
<p><strong>Related examples</strong>: - <a href="example-feature-engineering.html">Feature Engineering</a> -
Location-based features - <a href="example-grid-search.html">Grid
Search</a> - Parameter optimization for spatial models - <a href="example-risk-modeling.html">Risk Modeling</a> - Geographic risk
assessment</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>staRburst is developed by <a href="https://github.com/scttfrdmn" class="external-link">Scott Friedman</a>.</p>
<p>Contact: <a href="mailto:help@starburst.ing">help@starburst.ing</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> and powered by <a href="https://paws-r.github.io/" class="external-link">paws</a>.</p>
</div>

    </footer>
</div>





  </body>
</html>
